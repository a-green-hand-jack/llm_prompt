---
description: "å¯è§†åŒ–ä½¿ç”¨è§„èŒƒ"
globs: ["**/*.py"]
alwaysApply: true
---

<!--
æœ¬æ¨¡æ¿ç”± Claude Sonnet 4 åˆ›å»ºï¼Œæ—¨åœ¨ä¸º AI åŠ©æ‰‹æä¾›ç»Ÿä¸€çš„å¯è§†åŒ–ä½¿ç”¨æ ‡å‡†å’Œè¾“å‡ºç®¡ç†è§„èŒƒã€‚

ä½¿ç”¨è¯´æ˜ï¼š
AI åŠ©æ‰‹ä½ å¥½ï¼Œè¯·ä½ å°†è‡ªå·±å®šä½ä¸ºä¸€åç»éªŒä¸°å¯Œçš„æ•°æ®å¯è§†åŒ–ä¸“å®¶å’Œç§‘å­¦å›¾è¡¨è®¾è®¡å¸ˆã€‚
å½“æˆ‘åœ¨ä»»ä½• Python è„šæœ¬ä¸­éœ€è¦åˆ›å»ºå›¾è¡¨ã€ç»˜å›¾æˆ–æ•°æ®å¯è§†åŒ–æ—¶ï¼Œä½ å¿…é¡»ä¸¥æ ¼éµå¾ªæœ¬æ–‡ä»¶å®šä¹‰çš„ä½¿ç”¨è§„èŒƒã€‚
è¿™å¥—è§„èŒƒé€‚ç”¨äºæ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰æ¨¡å—ï¼šsrc/æºä»£ç ã€tests/æµ‹è¯•ä»£ç ã€experiments/å®éªŒä»£ç ã€‚
ä½ çš„æ ¸å¿ƒä»»åŠ¡æ˜¯ç¡®ä¿æ¯ä¸ªè„šæœ¬çš„å¯è§†åŒ–è¾“å‡ºéƒ½ä½äºæ­£ç¡®çš„ç›®å½•ä¸­ï¼Œå¹¶éµå¾ªç»Ÿä¸€çš„è´¨é‡å’Œé£æ ¼æ ‡å‡†ã€‚
-->

# å¯è§†åŒ–ä½¿ç”¨è§„èŒƒ (Visualization Usage Specification)

## 1. æ ¸å¿ƒä½¿ç”¨åŸåˆ™ (Core Usage Principles)

- **è„šæœ¬å¯¼å‘è¾“å‡º**: æ¯ä¸ªè„šæœ¬çš„å¯è§†åŒ–ç»“æœå¿…é¡»è¾“å‡ºåˆ°å¯¹åº”çš„ `./outputs/<script_name>/` ç›®å½•
- **æ•°æ®è¿½æº¯æ€§**: å¯è§†åŒ–è„šæœ¬ä¸»è¦ä»ä¹‹å‰çš„å®éªŒç»“æœã€å¤„ç†æ•°æ®æˆ–æµ‹è¯•è¾“å‡ºä¸­æå–æ•°æ®è¿›è¡Œç»˜å›¾
- **è´¨é‡éªŒè¯**: åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å¯è§†åŒ–æ¥éªŒè¯å®ç°çš„æ­£ç¡®æ€§å’Œåˆç†æ€§
- **é£æ ¼ä¸€è‡´æ€§**: æ‰€æœ‰å¯è§†åŒ–å¿…é¡»é€šè¿‡ `VisualizationManager` ç±»å®ç°ï¼Œç¡®ä¿ç»Ÿä¸€é£æ ¼
- **è‹±æ–‡æ ‡å‡†**: æ‰€æœ‰å›¾è¡¨æ–‡å­—å¿…é¡»ä½¿ç”¨è‹±æ–‡ï¼Œä¿è¯å›½é™…åŒ–å…¼å®¹æ€§

---

## 2. è¾“å‡ºç›®å½•è§„èŒƒ (Output Directory Standards)

### 2.1. æ ‡å‡†è¾“å‡ºè·¯å¾„ç»“æ„
**ç»Ÿä¸€è¾“å‡ºç›®å½•æ ¼å¼**ï¼šæ‰€æœ‰æ¨¡å—éƒ½éµå¾ªç›¸åŒçš„è¾“å‡ºç»“æ„
```
# é€šç”¨è¾“å‡ºç»“æ„ï¼ˆé€‚ç”¨äº src/ã€experiments/ã€tests/ï¼‰
./outputs/<script_name>/
â”œâ”€â”€ figures/                     # å¯è§†åŒ–å›¾è¡¨
â”‚   â”œâ”€â”€ correlation_analysis.png
â”‚   â”œâ”€â”€ performance_comparison.png
â”‚   â””â”€â”€ distribution_plots.png
â”œâ”€â”€ data_extracts/              # å¯è§†åŒ–ç”¨çš„æ•°æ®æå–
â”‚   â”œâ”€â”€ processed_data.csv
â”‚   â”œâ”€â”€ filtered_results.json
â”‚   â””â”€â”€ summary_statistics.csv
â””â”€â”€ logs/                       # å¯è§†åŒ–æ‰§è¡Œæ—¥å¿—
    â””â”€â”€ visualization.log

# src/ æ¨¡å—ç¤ºä¾‹ï¼ˆè¾“å‡ºåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
project_root/
â”œâ”€â”€ src/analysis/data_analyzer.py      # è„šæœ¬ä½ç½®
â””â”€â”€ outputs/data_analyzer/             # è¾“å‡ºä½ç½®ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
    â”œâ”€â”€ figures/
    â”œâ”€â”€ data_extracts/
    â””â”€â”€ logs/

# experiments/ æ¨¡å—ç¤ºä¾‹ï¼ˆè¾“å‡ºåœ¨å®éªŒç›®å½•å†…ï¼‰
experiments/protein_study/
â”œâ”€â”€ scripts/03_visualization_analysis.py   # è„šæœ¬ä½ç½®
â””â”€â”€ outputs/03_visualization_analysis/     # è¾“å‡ºä½ç½®ï¼ˆåœ¨å®éªŒç›®å½•å†…ï¼‰
    â”œâ”€â”€ figures/
    â”œâ”€â”€ data_extracts/
    â””â”€â”€ logs/

# tests/ æ¨¡å—ç¤ºä¾‹ï¼ˆè¾“å‡ºåœ¨testsç›®å½•å†…ï¼‰
tests/
â”œâ”€â”€ test_model_validation.py              # è„šæœ¬ä½ç½®
â””â”€â”€ outputs/test_model_validation/        # è¾“å‡ºä½ç½®ï¼ˆåœ¨testsç›®å½•å†…ï¼‰
    â”œâ”€â”€ figures/
    â”œâ”€â”€ data_extracts/
    â””â”€â”€ logs/
```

### 2.2. è„šæœ¬åç§°æå–ä¸ç›®å½•è®¾ç½®
```python
# æ ‡å‡†çš„è„šæœ¬åç§°å’Œè¾“å‡ºç›®å½•è®¾ç½®
import os
import logging
from pathlib import Path

def setup_visualization_environment():
    """è®¾ç½®ç»Ÿä¸€çš„å¯è§†åŒ–è¾“å‡ºç¯å¢ƒ"""
    
    # è·å–å½“å‰è„šæœ¬åï¼ˆä¸å«æ‰©å±•åï¼‰
    script_name = Path(__file__).stem
    
    # æ ¹æ®è„šæœ¬ä½ç½®ç¡®å®šè¾“å‡ºæ ¹ç›®å½•
    current_path = Path(__file__).resolve()
    
    if "src" in current_path.parts:
        # srcæ¨¡å—ï¼šè¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•çš„outputs
        project_root = current_path
        for parent in current_path.parents:
            if "src" in parent.parts and (parent / "src").exists():
                project_root = parent
                break
        base_output_dir = project_root / "outputs" / script_name
        
    elif "experiments" in current_path.parts:
        # experimentsæ¨¡å—ï¼šè¾“å‡ºåˆ°å®éªŒç›®å½•çš„outputs
        experiment_root = Path.cwd()  # å‡è®¾åœ¨å®éªŒç›®å½•ä¸‹æ‰§è¡Œ
        base_output_dir = experiment_root / "outputs" / script_name
        
    elif "tests" in current_path.parts:
        # testsæ¨¡å—ï¼šè¾“å‡ºåˆ°testsç›®å½•çš„outputs
        tests_root = current_path
        for parent in current_path.parents:
            if parent.name == "tests":
                tests_root = parent
                break
        base_output_dir = tests_root / "outputs" / script_name
        
    else:
        # é»˜è®¤ï¼šå½“å‰ç›®å½•çš„outputs
        base_output_dir = Path.cwd() / "outputs" / script_name
    
    # åˆ›å»ºå­ç›®å½•
    figures_dir = base_output_dir / "figures"
    data_extracts_dir = base_output_dir / "data_extracts" 
    logs_dir = base_output_dir / "logs"
    
    # ç¡®ä¿æ‰€æœ‰ç›®å½•å­˜åœ¨
    for directory in [figures_dir, data_extracts_dir, logs_dir]:
        directory.mkdir(parents=True, exist_ok=True)
    
    # è®¾ç½®æ—¥å¿—
    log_file = logs_dir / "visualization.log"
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler(log_file),
            logging.StreamHandler()
        ]
    )
    
    logging.info(f"ğŸ“ è¾“å‡ºç›®å½•è®¾ç½®: {base_output_dir}")
    
    return {
        'base': base_output_dir,
        'figures': figures_dir,
        'data_extracts': data_extracts_dir,
        'logs': logs_dir
    }

# æ¯ä¸ªåŒ…å«å¯è§†åŒ–çš„è„šæœ¬å¿…é¡»åŒ…å«æ­¤è®¾ç½®
OUTPUT_DIRS = setup_visualization_environment()
```

---

## 3. è¾“å‡ºæ ¼å¼ç­–ç•¥ (Output Format Strategy)

### 3.1. æ ¼å¼é€‰æ‹©åŸåˆ™
**åŸºäºä½¿ç”¨ç¯å¢ƒçš„æ ¼å¼ç­–ç•¥**ï¼š

- **src/ å’Œ tests/ æ¨¡å—**: ä¼˜å…ˆä½¿ç”¨ **PNG** æ ¼å¼
  - åŸå› ï¼šå¿«é€Ÿè¿­ä»£ã€ä¾¿äºæŸ¥çœ‹ã€æ–‡ä»¶è¾ƒå°
  - è®¾ç½®ï¼š`output_format="png", dpi=300`

- **experiments/ æ¨¡å—**: ä½¿ç”¨ **PNG + PDF** åŒæ ¼å¼
  - PNGï¼šç”¨äºå¿«é€ŸæŸ¥çœ‹å’Œåˆ†äº«
  - PDFï¼šç”¨äºæ­£å¼æŠ¥å‘Šå’Œå‡ºç‰ˆ
  - è®¾ç½®ï¼š`output_formats=["png", "pdf"], dpi=300`

### 3.2. åŠ¨æ€æ ¼å¼é…ç½®
```python
def determine_output_formats(module_type: str = None, user_preference: str = None):
    """æ ¹æ®æ¨¡å—ç±»å‹å’Œç”¨æˆ·åå¥½ç¡®å®šè¾“å‡ºæ ¼å¼"""
    
    if user_preference:
        # ç”¨æˆ·æ˜ç¡®æŒ‡å®šæ ¼å¼æ—¶ä¼˜å…ˆä½¿ç”¨
        return [user_preference.lower()]
    
    # æ ¹æ®è„šæœ¬ä½ç½®è‡ªåŠ¨åˆ¤æ–­
    current_path = Path.cwd()
    
    if "experiments" in str(current_path):
        return ["png", "pdf"]  # å®éªŒç¯å¢ƒä½¿ç”¨åŒæ ¼å¼
    elif any(x in str(current_path) for x in ["src", "tests"]):
        return ["png"]         # å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨PNG
    else:
        return ["png"]         # é»˜è®¤ä½¿ç”¨PNG

def save_visualization_with_formats(viz_manager, plot_data, base_filename: str):
    """æŒ‰æ ¼å¼ç­–ç•¥ä¿å­˜å¯è§†åŒ–"""
    
    formats = determine_output_formats()
    
    for fmt in formats:
        output_path = OUTPUT_DIRS['figures'] / f"{base_filename}.{fmt}"
        
        # æ ¹æ®æ ¼å¼è°ƒæ•´ä¿å­˜å‚æ•°
        save_params = {
            'png': {'dpi': 300, 'facecolor': 'white', 'transparent': False},
            'pdf': {'dpi': 300, 'facecolor': 'white', 'bbox_inches': 'tight'}
        }
        
        viz_manager.save_figure(plot_data, str(output_path), **save_params[fmt])
        logging.info(f"ğŸ’¾ å·²ä¿å­˜ {fmt.upper()} æ ¼å¼: {output_path}")
```

---

## 4. æ•°æ®æ¥æºä¸å¤„ç†è§„èŒƒ (Data Source & Processing Standards)

### 4.1. ä»å®éªŒç»“æœæå–æ•°æ®
**ä½¿ç”¨åœºæ™¯**: å¯è§†åŒ–è„šæœ¬åˆ†æä¹‹å‰å®éªŒçš„è¾“å‡ºç»“æœ

```python
#!/usr/bin/env python3
"""
å®éªŒç»“æœå¯è§†åŒ–è„šæœ¬

ä»ä¹‹å‰çš„å®éªŒç»“æœä¸­æå–å…³é”®æ•°æ®å¹¶è¿›è¡Œå¯è§†åŒ–åˆ†æã€‚

è¾“å…¥: å…¶ä»–å®éªŒçš„è¾“å‡ºç»“æœ
è¾“å‡º: ./outputs/analyze_experiment_results/
"""

from pathlib import Path
import pandas as pd
import numpy as np
import json
import logging
from utils.visualization_utils import VisualizationManager

# è®¾ç½®è¾“å‡ºç¯å¢ƒ
OUTPUT_DIRS = setup_visualization_environment()

def load_experiment_data():
    """ä»ä¹‹å‰çš„å®éªŒä¸­åŠ è½½æ•°æ®"""
    
    logging.info("ğŸ“¥ å¼€å§‹åŠ è½½å®éªŒæ•°æ®...")
    
    # ç¤ºä¾‹ï¼šä»å…¶ä»–å®éªŒç»“æœä¸­è¯»å–æ•°æ®
    exp1_results = pd.read_csv("experiments/protein_analysis/outputs/02_feature_extraction/data_extracts/features.csv")
    exp2_results = pd.read_csv("experiments/model_training/outputs/03_evaluation/data_extracts/results.csv")
    
    # æ•°æ®æ•´åˆå’Œæ¸…æ´—
    combined_data = merge_experimental_data(exp1_results, exp2_results)
    
    # ä¿å­˜å¤„ç†åçš„æ•°æ®åˆ°data_extracts
    processed_data_path = OUTPUT_DIRS['data_extracts'] / "combined_experiment_data.csv"
    combined_data.to_csv(processed_data_path, index=False)
    logging.info(f"ğŸ’¾ å·²ä¿å­˜å¤„ç†åçš„æ•°æ®: {processed_data_path}")
    
    # è®°å½•æ•°æ®æ¥æºä¿¡æ¯
    data_sources = {
        "experiment_1": "experiments/protein_analysis/outputs/02_feature_extraction/data_extracts/features.csv",
        "experiment_2": "experiments/model_training/outputs/03_evaluation/data_extracts/results.csv",
        "processing_date": "2025-09-23",
        "script": str(__file__),
        "total_records": len(combined_data),
        "columns": list(combined_data.columns)
    }
    
    sources_path = OUTPUT_DIRS['data_extracts'] / "data_sources.json"
    with open(sources_path, 'w') as f:
        json.dump(data_sources, f, indent=2)
    logging.info(f"ğŸ“‹ å·²è®°å½•æ•°æ®æ¥æº: {sources_path}")
    
    return combined_data

def create_analysis_visualizations(data):
    """åˆ›å»ºåˆ†æå¯è§†åŒ–å›¾è¡¨"""
    
    logging.info("ğŸ¨ å¼€å§‹åˆ›å»ºå¯è§†åŒ–å›¾è¡¨...")
    viz = VisualizationManager()
    
    # 1. æ€§èƒ½å¯¹æ¯”åˆ†æ
    if 'strategy' in data.columns and 'performance' in data.columns:
        output_path = OUTPUT_DIRS['figures'] / "strategy_performance_comparison.png"
        viz.create_box_plot(
            data=data,
            x_col='strategy', 
            y_col='performance',
            output_path=str(output_path),
            title="Strategy Performance Comparison",
            xlabel="Strategy Type",
            ylabel="Performance Score"
        )
        logging.info("âœ… ç­–ç•¥æ€§èƒ½å¯¹æ¯”å›¾å·²ç”Ÿæˆ")
    
    # 2. ç‰¹å¾ç›¸å…³æ€§åˆ†æ
    numeric_cols = data.select_dtypes(include=[np.number]).columns
    if len(numeric_cols) >= 2:
        correlation_matrix = data[numeric_cols].corr()
        
        # ä¿å­˜ç›¸å…³æ€§æ•°æ®
        corr_data_path = OUTPUT_DIRS['data_extracts'] / "correlation_matrix.csv"
        correlation_matrix.to_csv(corr_data_path)
        logging.info(f"ğŸ’¾ ç›¸å…³æ€§çŸ©é˜µæ•°æ®å·²ä¿å­˜: {corr_data_path}")
        
        # ç”Ÿæˆçƒ­å›¾
        output_path = OUTPUT_DIRS['figures'] / "feature_correlation_matrix.png"
        viz.create_heatmap(
            data=correlation_matrix,
            output_path=str(output_path),
            title="Feature Correlation Analysis"
        )
        logging.info("âœ… ç‰¹å¾ç›¸å…³æ€§çƒ­å›¾å·²ç”Ÿæˆ")

if __name__ == "__main__":
    logging.info(f"ğŸ“Š å¼€å§‹åˆ†æå®éªŒç»“æœå¯è§†åŒ–")
    logging.info(f"ğŸ“ è¾“å‡ºç›®å½•: {OUTPUT_DIRS['base']}")
    
    # åŠ è½½æ•°æ®
    data = load_experiment_data()
    
    # åˆ›å»ºå¯è§†åŒ–
    create_analysis_visualizations(data)
    
    logging.info(f"âœ… å¯è§†åŒ–å®Œæˆï¼Œç»“æœä¿å­˜åœ¨: {OUTPUT_DIRS['base']}")
```

### 4.2. æµ‹è¯•ç»“æœå¯è§†åŒ–
**ä½¿ç”¨åœºæ™¯**: åœ¨æµ‹è¯•ä¸­å¯è§†åŒ–éªŒè¯å®ç°æ­£ç¡®æ€§

```python
#!/usr/bin/env python3
"""
æµ‹è¯•ç»“æœå¯è§†åŒ–

éªŒè¯ç®—æ³•å®ç°çš„æ­£ç¡®æ€§ï¼Œé€šè¿‡å¯è§†åŒ–æ£€æŸ¥ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

è¾“å…¥: æµ‹è¯•æ•°æ®å’Œç®—æ³•è¾“å‡º
è¾“å‡º: ./outputs/test_algorithm_validation/
"""

import pytest
import numpy as np
from pathlib import Path
from utils.visualization_utils import VisualizationManager

# æµ‹è¯•è¾“å‡ºè®¾ç½®
OUTPUT_DIRS = setup_visualization_environment()

def test_algorithm_with_visualization():
    """æµ‹è¯•ç®—æ³•å¹¶å¯è§†åŒ–éªŒè¯ç»“æœ"""
    
    # å‡†å¤‡æµ‹è¯•æ•°æ®
    np.random.seed(42)
    x_test = np.linspace(0, 10, 100)
    y_expected = 2 * x_test + 1  # é¢„æœŸçš„çº¿æ€§å…³ç³»
    y_actual = my_algorithm(x_test)  # ç®—æ³•å®é™…è¾“å‡º
    
    # ä¿å­˜æµ‹è¯•æ•°æ®
    test_data = pd.DataFrame({
        'input': x_test,
        'expected': y_expected,
        'actual': y_actual
    })
    test_data_path = OUTPUT_DIRS['data_extracts'] / "test_comparison_data.csv"
    test_data.to_csv(test_data_path, index=False)
    logging.info(f"ğŸ’¾ æµ‹è¯•æ•°æ®å·²ä¿å­˜: {test_data_path}")
    
    # åˆå§‹åŒ–å¯è§†åŒ–
    viz = VisualizationManager()
    
    # 1. é¢„æœŸ vs å®é™…ç»“æœå¯¹æ¯”
    viz.create_scatter_plot(
        x_data=y_expected,
        y_data=y_actual,
        output_path=str(OUTPUT_DIRS['figures'] / "expected_vs_actual.png"),
        title="Algorithm Validation: Expected vs Actual",
        xlabel="Expected Values",
        ylabel="Actual Values", 
        add_trend_line=True
    )
    
    # 2. è¯¯å·®åˆ†å¸ƒåˆ†æ
    errors = y_actual - y_expected
    viz.create_histogram(
        data=errors,
        output_path=str(OUTPUT_DIRS['figures'] / "error_distribution.png"),
        title="Algorithm Error Distribution", 
        xlabel="Error Value",
        ylabel="Frequency"
    )
    
    # éªŒè¯ç»“æœ
    mse = np.mean(errors**2)
    assert mse < 0.1, f"ç®—æ³•è¯¯å·®è¿‡å¤§: MSE = {mse}"
    
    logging.info(f"âœ… æµ‹è¯•é€šè¿‡ï¼Œå¯è§†åŒ–ç»“æœä¿å­˜åœ¨: {OUTPUT_DIRS['base']}")

def my_algorithm(x):
    """ç¤ºä¾‹ç®—æ³•å®ç°"""
    return 2 * x + 1 + np.random.normal(0, 0.05, len(x))

if __name__ == "__main__":
    test_algorithm_with_visualization()
```

### 4.3. å®éªŒè¿›åº¦å¯è§†åŒ–
**ä½¿ç”¨åœºæ™¯**: å®éªŒè„šæœ¬ä¸­çš„ä¸­é—´ç»“æœå¯è§†åŒ–

```python
#!/usr/bin/env python3
"""
03_model_evaluation.py

æ¨¡å‹è¯„ä¼°å®éªŒè„šæœ¬ï¼ŒåŒ…å«è®­ç»ƒè¿‡ç¨‹å’Œç»“æœçš„å¯è§†åŒ–ã€‚

è¾“å…¥: è®­ç»ƒå¥½çš„æ¨¡å‹å’Œæµ‹è¯•æ•°æ®
è¾“å‡º: ./outputs/03_model_evaluation/
"""

from pathlib import Path
import pandas as pd
import numpy as np

# å®éªŒç¯å¢ƒè®¾ç½®
EXPERIMENT_ROOT = Path.cwd()
OUTPUT_DIRS = setup_visualization_environment()

# å¯¼å…¥å¯è§†åŒ–å·¥å…·ï¼ˆå®éªŒç¯å¢ƒä¸­çš„å¯¼å…¥æ–¹å¼ï¼‰
import sys
sys.path.append(str(EXPERIMENT_ROOT.parent.parent / "utils"))
from visualization_utils import VisualizationManager

def evaluate_model_with_visualization():
    """æ¨¡å‹è¯„ä¼°ä¸å¯è§†åŒ–"""
    
    logging.info(f"ğŸ“Š å¼€å§‹æ¨¡å‹è¯„ä¼°")
    
    # 1. ä»ä¹‹å‰çš„å®éªŒæ­¥éª¤åŠ è½½æ•°æ®
    model_path = EXPERIMENT_ROOT / "outputs" / "02_model_training" / "data_extracts" / "trained_model.pkl"
    test_data_path = EXPERIMENT_ROOT / "data" / "processed" / "test_data.csv"
    
    # åŠ è½½æ¨¡å‹å’Œæ•°æ®
    model = load_model(model_path) 
    test_data = pd.read_csv(test_data_path)
    
    # 2. æ¨¡å‹é¢„æµ‹
    y_true = test_data['target'].values
    y_pred = model.predict(test_data.drop('target', axis=1))
    
    # ä¿å­˜è¯„ä¼°æ•°æ®
    eval_results = pd.DataFrame({
        'true_values': y_true,
        'predictions': y_pred,
        'errors': y_pred - y_true
    })
    eval_data_path = OUTPUT_DIRS['data_extracts'] / "evaluation_results.csv"
    eval_results.to_csv(eval_data_path, index=False)
    
    # 3. å¯è§†åŒ–ç»“æœ
    viz = VisualizationManager()
    
    # é¢„æµ‹å‡†ç¡®æ€§æ•£ç‚¹å›¾
    viz.create_scatter_plot(
        x_data=y_true,
        y_data=y_pred,
        output_path=str(OUTPUT_DIRS['figures'] / "prediction_accuracy.png"),
        title="Model Prediction Accuracy",
        xlabel="True Values", 
        ylabel="Predicted Values",
        add_trend_line=True
    )
    
    # é¢„æµ‹è¯¯å·®åˆ†å¸ƒ
    errors = y_pred - y_true
    viz.create_histogram(
        data=errors,
        output_path=str(OUTPUT_DIRS['figures'] / "prediction_errors.png"),
        title="Prediction Error Distribution",
        xlabel="Prediction Error",
        ylabel="Frequency"
    )
    
    # 4. ä¿å­˜è¯„ä¼°æŒ‡æ ‡
    from sklearn.metrics import mean_squared_error, r2_score
    metrics = {
        'mse': float(mean_squared_error(y_true, y_pred)),
        'r2': float(r2_score(y_true, y_pred)),
        'n_samples': len(y_true)
    }
    
    metrics_path = OUTPUT_DIRS['data_extracts'] / "evaluation_metrics.json"
    with open(metrics_path, 'w') as f:
        json.dump(metrics, f, indent=2)
    
    logging.info(f"âœ… æ¨¡å‹è¯„ä¼°å®Œæˆ")
    logging.info(f"ğŸ“ˆ MSE: {metrics['mse']:.4f}")
    logging.info(f"ğŸ“ˆ RÂ²: {metrics['r2']:.4f}")
    
    return metrics

if __name__ == "__main__":
    evaluate_model_with_visualization()
```

---

## 5. å¯è§†åŒ–å·¥å…·ä½¿ç”¨è§„èŒƒ (Visualization Tool Usage Standards)

### 5.1. å¿…é¡»ä½¿ç”¨ VisualizationManager
æ‰€æœ‰å¯è§†åŒ–å¿…é¡»é€šè¿‡æ ‡å‡†å·¥å…·ç±»å®ç°ï¼š

```python
# âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼
from utils.visualization_utils import VisualizationManager

viz = VisualizationManager()  # è‡ªåŠ¨åŠ è½½é…ç½®
viz.create_scatter_plot(...)

# âŒ ç¦æ­¢ç›´æ¥ä½¿ç”¨ matplotlib/seaborn
import matplotlib.pyplot as plt  # ç¦æ­¢
plt.scatter(...)  # ç¦æ­¢
```

### 5.2. è¾“å‡ºè·¯å¾„è§„èŒƒåŒ–
```python
# âœ… æ ‡å‡†è¾“å‡ºè·¯å¾„è®¾ç½®
OUTPUT_DIRS = setup_visualization_environment()

# æ‰€æœ‰å¯è§†åŒ–è¾“å‡ºå¿…é¡»åœ¨å¯¹åº”ç›®å½•ä¸‹
viz.create_scatter_plot(
    ...,
    output_path=str(OUTPUT_DIRS['figures'] / "analysis_results.png")  # ä½¿ç”¨æ ‡å‡†è·¯å¾„
)

# âŒ ç¦æ­¢çš„è¾“å‡ºè·¯å¾„
viz.create_scatter_plot(
    ..., 
    output_path="./figure.png"  # ç›´æ¥æ”¾åœ¨å½“å‰ç›®å½•
)
```

### 5.3. å›¾è¡¨å‘½åè§„èŒƒ
```python
# âœ… æ¸…æ™°çš„è‹±æ–‡å‘½å
"feature_correlation_matrix.png"
"model_performance_comparison.png" 
"prediction_accuracy_scatter.png"
"error_distribution_histogram.png"

# âŒ ä¸æ¸…æ™°çš„å‘½å
"plot1.png"
"å›¾è¡¨.png" 
"temp.png"
```

---

## 6. è´¨é‡æ§åˆ¶ä¸éªŒè¯ (Quality Control & Validation)

### 6.1. è¾“å‡ºéªŒè¯æ£€æŸ¥
æ¯ä¸ªå¯è§†åŒ–è„šæœ¬å¿…é¡»åŒ…å«è¾“å‡ºéªŒè¯ï¼š

```python
def validate_visualization_outputs(output_dirs: dict) -> bool:
    """éªŒè¯å¯è§†åŒ–è¾“å‡ºè´¨é‡"""
    
    success = True
    
    # æ£€æŸ¥è¾“å‡ºç›®å½•
    if not output_dirs['base'].exists():
        logging.error(f"âŒ è¾“å‡ºç›®å½•ä¸å­˜åœ¨: {output_dirs['base']}")
        return False
        
    # æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶
    image_files = list(output_dirs['figures'].glob("*.png")) + list(output_dirs['figures'].glob("*.pdf"))
    if not image_files:
        logging.error(f"âŒ æœªæ‰¾åˆ°è¾“å‡ºå›¾ç‰‡: {output_dirs['figures']}")
        return False
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé¿å…ç©ºæ–‡ä»¶ï¼‰
    for img_file in image_files:
        if img_file.stat().st_size < 10000:  # å°äº10KBå¯èƒ½æœ‰é—®é¢˜
            logging.warning(f"âš ï¸ å›¾ç‰‡æ–‡ä»¶è¿‡å°: {img_file}")
            success = False
    
    # æ£€æŸ¥æ•°æ®æå–æ–‡ä»¶
    data_files = list(output_dirs['data_extracts'].glob("*"))
    if data_files:
        logging.info(f"âœ… æ•°æ®æå–æ–‡ä»¶: {len(data_files)} ä¸ª")
    
    # æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
    log_file = output_dirs['logs'] / "visualization.log"
    if log_file.exists():
        logging.info(f"âœ… æ—¥å¿—æ–‡ä»¶å­˜åœ¨: {log_file}")
    
    if success:
        logging.info(f"âœ… å¯è§†åŒ–è¾“å‡ºéªŒè¯é€šè¿‡: {len(image_files)} ä¸ªå›¾ç‰‡æ–‡ä»¶")
    
    return success

# åœ¨è„šæœ¬æœ«å°¾è°ƒç”¨éªŒè¯
if __name__ == "__main__":
    # ... æ‰§è¡Œå¯è§†åŒ– ...
    
    # éªŒè¯è¾“å‡º
    if validate_visualization_outputs(OUTPUT_DIRS):
        logging.info(f"ğŸ¯ è„šæœ¬æ‰§è¡ŒæˆåŠŸ: {Path(__file__).stem}")
    else:
        logging.error(f"âŒ è„šæœ¬æ‰§è¡Œæœ‰é—®é¢˜: {Path(__file__).stem}")
        exit(1)
```

### 6.2. ä¾èµ–æ£€æŸ¥æ ‡å‡†
æ¯ä¸ªå¯è§†åŒ–è„šæœ¬å¼€å¤´å¿…é¡»åŒ…å«ä¾èµ–æ£€æŸ¥ï¼š

```python
def check_dependencies():
    """æ£€æŸ¥å¯è§†åŒ–ä¾èµ–"""
    required_packages = ['matplotlib', 'seaborn', 'pandas', 'numpy']
    missing = []
    
    for package in required_packages:
        try:
            __import__(package)
        except ImportError:
            missing.append(package)
    
    if missing:
        logging.error(f"âŒ ç¼ºå°‘ä¾èµ–: {', '.join(missing)}")
        logging.info(f"ğŸ“¦ å®‰è£…å‘½ä»¤: mamba install {' '.join(missing)}")
        exit(1)

# è„šæœ¬å¼€å¤´è°ƒç”¨
check_dependencies()
```

---

## 7. ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ (Usage Scenario Examples)

### 7.1. Few-Shot ç¤ºä¾‹é›†åˆ

**åœºæ™¯1ï¼šå¿«é€ŸåŸå‹éªŒè¯ï¼ˆsrc/æ¨¡å—ï¼‰**
```python
# src/analysis/quick_model_check.py
# ç›®æ ‡ï¼šå¿«é€ŸéªŒè¯æ¨¡å‹è¾“å‡ºæ˜¯å¦åˆç†
# æ ¼å¼ï¼šPNGï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰
# æ•°æ®ï¼šä»æ¨¡å‹è®­ç»ƒç»“æœæå–

OUTPUT_DIRS = setup_visualization_environment()
viz = VisualizationManager()

# åŠ è½½æ¨¡å‹é¢„æµ‹ç»“æœ
predictions = pd.read_csv("src/models/outputs/model_predictions/data_extracts/predictions.csv")

# å¿«é€Ÿæ•£ç‚¹å›¾éªŒè¯
viz.create_scatter_plot(
    x_data=predictions['actual'], 
    y_data=predictions['predicted'],
    output_path=str(OUTPUT_DIRS['figures'] / "prediction_validation.png"),
    title="Quick Model Validation",
    add_trend_line=True
)
```

**åœºæ™¯2ï¼šå®éªŒç»“æœåˆ†æï¼ˆexperiments/æ¨¡å—ï¼‰**
```python
# experiments/comparative_study/scripts/05_final_analysis.py  
# ç›®æ ‡ï¼šç”Ÿæˆæ­£å¼çš„å®éªŒæŠ¥å‘Šå›¾è¡¨
# æ ¼å¼ï¼šPNG + PDFï¼ˆæŠ¥å‘Šç”¨ï¼‰
# æ•°æ®ï¼šæ±‡æ€»å¤šä¸ªå®éªŒæ­¥éª¤çš„ç»“æœ

OUTPUT_DIRS = setup_visualization_environment()

# è®¾ç½®å®éªŒç¯å¢ƒçš„åŒæ ¼å¼è¾“å‡º
def save_experiment_plot(viz, data, filename, title):
    for fmt in ["png", "pdf"]:
        output_path = OUTPUT_DIRS['figures'] / f"{filename}.{fmt}"
        # æ ¹æ®ç”¨æˆ·è¦æ±‚é€‰æ‹©æ ¼å¼...
```

**åœºæ™¯3ï¼šæµ‹è¯•ç»“æœéªŒè¯ï¼ˆtests/æ¨¡å—ï¼‰**  
```python
# tests/test_algorithm_accuracy.py
# ç›®æ ‡ï¼šå¯è§†åŒ–éªŒè¯ç®—æ³•å‡†ç¡®æ€§
# æ ¼å¼ï¼šPNGï¼ˆæµ‹è¯•æŠ¥å‘Šï¼‰
# æ•°æ®ï¼šç®—æ³•è¾“å‡ºä¸é¢„æœŸç»“æœå¯¹æ¯”

def test_algorithm_accuracy_with_plot():
    OUTPUT_DIRS = setup_visualization_environment()
    
    # ä¿å­˜æµ‹è¯•æ•°æ®ç”¨äºåˆ†æ
    test_results = pd.DataFrame({
        'input': test_inputs,
        'expected': expected_outputs, 
        'actual': algorithm_outputs
    })
    
    test_data_path = OUTPUT_DIRS['data_extracts'] / "test_comparison_data.csv"
    test_results.to_csv(test_data_path, index=False)
    
    # ç”ŸæˆéªŒè¯å›¾è¡¨
    viz.create_scatter_plot(
        x_data=expected_outputs,
        y_data=algorithm_outputs,
        output_path=str(OUTPUT_DIRS['figures'] / "algorithm_accuracy_test.png"),
        title="Algorithm Accuracy Test Results"
    )
```

**åœºæ™¯4ï¼šæ•°æ®æ¢ç´¢åˆ†æ**
```python
# ä»»æ„ä½ç½®çš„æ•°æ®æ¢ç´¢è„šæœ¬
# ç›®æ ‡ï¼šç†è§£æ•°æ®åˆ†å¸ƒå’Œç‰¹å¾
# æ ¼å¼ï¼šæ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©
# æ•°æ®ï¼šåŸå§‹æ•°æ®é›†æˆ–é¢„å¤„ç†ç»“æœ

def explore_dataset(data_path: str):
    OUTPUT_DIRS = setup_visualization_environment()
    
    # åŠ è½½æ•°æ®
    data = pd.read_csv(data_path)
    
    # ä¿å­˜æ•°æ®æ‘˜è¦
    summary_stats = data.describe()
    summary_path = OUTPUT_DIRS['data_extracts'] / "dataset_summary.csv"
    summary_stats.to_csv(summary_path)
    
    # ç”Ÿæˆæ¢ç´¢æ€§å›¾è¡¨
    viz = VisualizationManager()
    
    # æ ¹æ®å½“å‰ç¯å¢ƒé€‰æ‹©è¾“å‡ºæ ¼å¼
    formats = determine_output_formats()
    
    for fmt in formats:
        correlation_path = OUTPUT_DIRS['figures'] / f"feature_correlations.{fmt}"
        # åˆ›å»ºç›¸å…³æ€§çƒ­å›¾...
```

### 7.2. ç”¨æˆ·æŒ‡å®šæ ¼å¼å¤„ç†
```python
def handle_user_format_preference(user_request: str):
    """å¤„ç†ç”¨æˆ·çš„æ ¼å¼åå¥½"""
    
    # è§£æç”¨æˆ·è¦æ±‚
    if "pdf" in user_request.lower() or "publication" in user_request.lower():
        return ["png", "pdf"]  # ç”¨äºå‡ºç‰ˆçš„é«˜è´¨é‡è¾“å‡º
    elif "quick" in user_request.lower() or "draft" in user_request.lower():
        return ["png"]         # å¿«é€Ÿé¢„è§ˆ
    elif "report" in user_request.lower():
        # æ ¹æ®æ‰€åœ¨æ¨¡å—å†³å®š
        return determine_output_formats()
    else:
        return ["png"]  # é»˜è®¤æ ¼å¼

# ä½¿ç”¨ç¤ºä¾‹
def create_visualization_by_request(data, user_request: str):
    """æ ¹æ®ç”¨æˆ·è¦æ±‚åˆ›å»ºå¯è§†åŒ–"""
    
    OUTPUT_DIRS = setup_visualization_environment()
    formats = handle_user_format_preference(user_request)
    
    logging.info(f"ğŸ“Š æ ¹æ®ç”¨æˆ·è¦æ±‚ç”Ÿæˆæ ¼å¼: {', '.join(formats)}")
    
    viz = VisualizationManager()
    
    for fmt in formats:
        output_path = OUTPUT_DIRS['figures'] / f"analysis_result.{fmt}"
        viz.create_scatter_plot(
            data=data,
            output_path=str(output_path),
            # å…¶ä»–å‚æ•°...
        )
```

### 7.3. çµæ´»çš„ä½¿ç”¨åŸåˆ™
- **å“åº”ç”¨æˆ·éœ€æ±‚**ï¼šä¼˜å…ˆæŒ‰ç”¨æˆ·æ˜ç¡®è¦æ±‚çš„æ ¼å¼å’Œé£æ ¼
- **ç¯å¢ƒè‡ªé€‚åº”**ï¼šåœ¨ç”¨æˆ·æ²¡æœ‰æ˜ç¡®è¦æ±‚æ—¶ï¼Œæ ¹æ®è„šæœ¬ä½ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„è¾“å‡ºç­–ç•¥
- **ä¿æŒå®Œæ•´è®°å½•**ï¼šæ— è®ºä»€ä¹ˆåœºæ™¯ï¼Œéƒ½è¦ä¿å­˜æ•°æ®æå–å’Œæ‰§è¡Œæ—¥å¿—
- **è´¨é‡ä¸€è‡´æ€§**ï¼šæ‰€æœ‰è¾“å‡ºéƒ½éµå¾ªç»Ÿä¸€çš„å¯è§†åŒ–æ ‡å‡†å’Œè´¨é‡è¦æ±‚

---

## 8. ä¸åŒç¯å¢ƒçš„é€‚é… (Environment Adaptation)

### 8.1. src/ æ¨¡å—ä¸­çš„ä½¿ç”¨
```python
# src/analysis/data_visualizer.py
from pathlib import Path
from utils.visualization_utils import VisualizationManager

class DataVisualizer:
    def __init__(self):
        # è¾“å‡ºå°†åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ outputs/data_visualizer/ ä¸‹
        self.output_dirs = setup_visualization_environment()
        self.viz = VisualizationManager()
        
    def generate_report(self, data, report_name: str):
        """ç”Ÿæˆæ•°æ®æŠ¥å‘Š"""
        
        logging.info(f"ğŸ“Š ç”ŸæˆæŠ¥å‘Š: {report_name}")
        
        # ä¿å­˜æŠ¥å‘Šæ•°æ®
        report_data_path = self.output_dirs['data_extracts'] / f"{report_name}_data.csv"
        data.to_csv(report_data_path, index=False)
        
        # ç”Ÿæˆå„ç§å›¾è¡¨ï¼ˆä½¿ç”¨PNGæ ¼å¼ï¼Œå¿«é€Ÿè¿­ä»£ï¼‰
        self.viz.create_scatter_plot(
            ...,
            output_path=str(self.output_dirs['figures'] / f"{report_name}_correlation.png")
        )
        
        logging.info(f"âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: {self.output_dirs['base']}")

# ä½¿ç”¨ç¤ºä¾‹ï¼šä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
# python src/analysis/data_visualizer.py
# è¾“å‡ºï¼šproject_root/outputs/data_visualizer/
```

### 8.2. experiments/ æ¨¡å—ä¸­çš„ä½¿ç”¨
```python
# experiments/protein_analysis/scripts/05_results_visualization.py
from pathlib import Path
import sys

# å®éªŒç¯å¢ƒç‰¹æ®Šçš„å¯¼å…¥è®¾ç½®  
EXPERIMENT_ROOT = Path.cwd()
sys.path.append(str(EXPERIMENT_ROOT.parent.parent / "utils"))
from visualization_utils import VisualizationManager

# å®éªŒè¾“å‡ºç›®å½•ï¼ˆåœ¨å®éªŒç›®å½•å†…ï¼‰
OUTPUT_DIRS = setup_visualization_environment()
# è¾“å‡ºï¼šexperiments/protein_analysis/outputs/05_results_visualization/

def analyze_experiment_results():
    """åˆ†æå®éªŒç»“æœ"""
    
    logging.info("ğŸ“Š å¼€å§‹å®éªŒç»“æœåˆ†æ")
    
    # åŠ è½½ä¹‹å‰æ­¥éª¤çš„æ•°æ®
    step2_data = pd.read_csv(EXPERIMENT_ROOT / "outputs" / "02_data_processing" / "data_extracts" / "processed.csv")
    step4_data = pd.read_csv(EXPERIMENT_ROOT / "outputs" / "04_model_training" / "data_extracts" / "results.csv")
    
    # ä¿å­˜ç»¼åˆåˆ†ææ•°æ®
    combined_data = merge_analysis_data(step2_data, step4_data)
    analysis_path = OUTPUT_DIRS['data_extracts'] / "final_analysis.csv"
    combined_data.to_csv(analysis_path, index=False)
    
    # ç”Ÿæˆå®éªŒæŠ¥å‘Šå›¾è¡¨ï¼ˆPNG + PDFæ ¼å¼ï¼‰
    viz = VisualizationManager()
    formats = determine_output_formats()  # è‡ªåŠ¨æ£€æµ‹ä¸ºexperimentsç¯å¢ƒ
    
    for fmt in formats:
        output_path = OUTPUT_DIRS['figures'] / f"final_results.{fmt}"
        viz.create_box_plot(..., output_path=str(output_path))
```

### 8.3. tests/ æ¨¡å—ä¸­çš„ä½¿ç”¨
```python
# tests/test_model_validation.py
import pytest
from pathlib import Path
from utils.visualization_utils import VisualizationManager

class TestModelValidation:
    def test_model_predictions_with_plots(self):
        """æµ‹è¯•æ¨¡å‹é¢„æµ‹å¹¶ç”ŸæˆéªŒè¯å›¾è¡¨"""
        
        # æµ‹è¯•ä¸“ç”¨è¾“å‡ºç›®å½•ï¼ˆåœ¨testsç›®å½•ä¸‹ï¼‰
        output_dirs = setup_visualization_environment()
        # è¾“å‡ºï¼štests/outputs/test_model_validation/
        
        viz = VisualizationManager()
        
        # æ‰§è¡Œæµ‹è¯•
        predictions = model.predict(test_data)
        accuracy = calculate_accuracy(predictions, expected)
        
        # ä¿å­˜æµ‹è¯•æ•°æ®ç”¨äºåˆ†æ
        test_results = pd.DataFrame({
            'expected': expected,
            'predicted': predictions,
            'accuracy': accuracy
        })
        
        test_data_path = output_dirs['data_extracts'] / "test_results.csv"
        test_results.to_csv(test_data_path, index=False)
        
        # ç”Ÿæˆæµ‹è¯•éªŒè¯å›¾è¡¨ï¼ˆPNGæ ¼å¼ï¼Œå¿«é€ŸæŸ¥çœ‹ï¼‰
        viz.create_scatter_plot(
            x_data=expected,
            y_data=predictions,
            output_path=str(output_dirs['figures'] / "prediction_validation.png"),
            title="Model Prediction Validation Test"
        )
        
        # æ–­è¨€æµ‹è¯•ç»“æœ
        assert accuracy > 0.9
        
        logging.info(f"âœ… æµ‹è¯•é€šè¿‡ï¼ŒéªŒè¯å›¾è¡¨å·²ä¿å­˜: {output_dirs['figures']}")
```

---

## 9. AI å®æ–½æŒ‡å— (AI Implementation Guidelines)

### 9.1. ç”Ÿæˆå¯è§†åŒ–ä»£ç æ—¶çš„æ£€æŸ¥æ¸…å•
- [ ] ç¡®è®¤è„šæœ¬è¾“å‡ºç›®å½•è®¾ç½®æ­£ç¡® (`outputs/<script_name>/` åŒ…å« figuresã€data_extractsã€logs)
- [ ] ä½¿ç”¨ `VisualizationManager` è€Œéç›´æ¥è°ƒç”¨ matplotlib
- [ ] æ‰€æœ‰å›¾è¡¨æ ‡é¢˜ã€æ ‡ç­¾ä½¿ç”¨è‹±æ–‡
- [ ] åŒ…å«ä¾èµ–æ£€æŸ¥é€»è¾‘
- [ ] è®¾ç½®æ—¥å¿—è®°å½•åˆ° logs/ ç›®å½•
- [ ] ä¿å­˜å¤„ç†åçš„æ•°æ®åˆ° data_extracts/ ç›®å½•  
- [ ] æ ¹æ®æ¨¡å—ç±»å‹é€‰æ‹©åˆé€‚çš„è¾“å‡ºæ ¼å¼ï¼ˆPNG vs PNG+PDFï¼‰
- [ ] è®°å½•æ•°æ®æ¥æºï¼ˆç‰¹åˆ«æ˜¯ä»å…¶ä»–å®éªŒæå–æ•°æ®æ—¶ï¼‰

### 9.2. ä»£ç ç”Ÿæˆæ¨¡æ¿
```python
#!/usr/bin/env python3
"""
{script_description}

è¾“å…¥: {input_description}
è¾“å‡º: ./outputs/{script_name}/
     â”œâ”€â”€ figures/     - å¯è§†åŒ–å›¾è¡¨
     â”œâ”€â”€ data_extracts/ - æ•°æ®æå–ç»“æœ
     â””â”€â”€ logs/        - æ‰§è¡Œæ—¥å¿—

ä½œè€…: AI Assistant
æ—¥æœŸ: {current_date}  
"""

from pathlib import Path
import pandas as pd
import numpy as np
import logging
import json

# å¯¼å…¥å¯è§†åŒ–å·¥å…·
from utils.visualization_utils import VisualizationManager

# è®¾ç½®è¾“å‡ºç¯å¢ƒ
OUTPUT_DIRS = setup_visualization_environment()

def main():
    """ä¸»å‡½æ•°"""
    logging.info(f"ğŸ“Š å¼€å§‹æ‰§è¡Œ: {Path(__file__).stem}")
    logging.info(f"ğŸ“ è¾“å‡ºç›®å½•: {OUTPUT_DIRS['base']}")
    
    # 1. æ•°æ®åŠ è½½å’Œå¤„ç†
    data = load_and_process_data()
    
    # 2. ä¿å­˜å¤„ç†åçš„æ•°æ®
    save_processed_data(data)
    
    # 3. å¯è§†åŒ–åˆ†æ
    create_visualizations(data)
    
    # 4. éªŒè¯è¾“å‡º
    if validate_outputs():
        logging.info(f"âœ… æ‰§è¡ŒæˆåŠŸ")
    else:
        logging.error(f"âŒ æ‰§è¡Œå¤±è´¥")
        exit(1)

def load_and_process_data():
    """åŠ è½½å’Œå¤„ç†æ•°æ®"""
    logging.info("ğŸ“¥ åŠ è½½æ•°æ®...")
    # TODO: å®ç°æ•°æ®åŠ è½½é€»è¾‘
    pass

def save_processed_data(data):
    """ä¿å­˜å¤„ç†åçš„æ•°æ®åˆ°data_extracts"""
    logging.info("ğŸ’¾ ä¿å­˜æ•°æ®æå–ç»“æœ...")
    
    # ä¿å­˜ä¸»è¦æ•°æ®
    data_path = OUTPUT_DIRS['data_extracts'] / "processed_data.csv"
    data.to_csv(data_path, index=False)
    
    # ä¿å­˜æ•°æ®æ‘˜è¦
    summary_path = OUTPUT_DIRS['data_extracts'] / "data_summary.json"
    summary = {
        "total_records": len(data),
        "columns": list(data.columns),
        "numeric_columns": list(data.select_dtypes(include=[np.number]).columns)
    }
    with open(summary_path, 'w') as f:
        json.dump(summary, f, indent=2)
    
    logging.info(f"ğŸ’¾ æ•°æ®å·²ä¿å­˜åˆ°: {OUTPUT_DIRS['data_extracts']}")

def create_visualizations(data):
    """åˆ›å»ºå¯è§†åŒ–å›¾è¡¨"""
    logging.info("ğŸ¨ ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨...")
    
    viz = VisualizationManager()
    
    # æ ¹æ®ç¯å¢ƒç¡®å®šè¾“å‡ºæ ¼å¼
    formats = determine_output_formats()
    
    # TODO: å®ç°å…·ä½“çš„å¯è§†åŒ–é€»è¾‘
    pass

def validate_outputs():
    """éªŒè¯è¾“å‡ºè´¨é‡"""
    # TODO: å®ç°è¾“å‡ºéªŒè¯é€»è¾‘
    return True

if __name__ == "__main__":
    main()
```

### 9.3. ä¾èµ–æ£€æŸ¥ä¸é”™è¯¯å¤„ç†
åœ¨ç”Ÿæˆå¯è§†åŒ–ä»£ç æ—¶ï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹æ£€æŸ¥ï¼š

```python
# ä¾èµ–åŒ…æ£€æŸ¥
required_packages = ['matplotlib', 'seaborn', 'pandas', 'numpy', 'pyyaml', 'scipy']
missing_packages = []

for package in required_packages:
    try:
        __import__(package)
    except ImportError:
        missing_packages.append(package)

if missing_packages:
    logging.error(f"âŒ ç¼ºå°‘ä¾èµ–åŒ…: {', '.join(missing_packages)}")
    logging.info(f"ğŸ“¦ å®‰è£…å‘½ä»¤: mamba install {' '.join(missing_packages)}")
    logging.info("âš ï¸  è¯·å®‰è£…ä¾èµ–åŒ…åå†è¿è¡Œ")
    exit(1)
```

---

## 10. é¡¹ç›®é›†æˆæŒ‡å— (Project Integration Guidelines)

### 10.1. åœ¨ä¸åŒæ¨¡å—ä¸­çš„ä½¿ç”¨

**åœ¨ src/ æºä»£ç ä¸­**:
```python
# src/analysis/visualization.py
from utils.visualization_utils import VisualizationManager

class DataAnalyzer:
    def __init__(self):
        self.output_dirs = setup_visualization_environment()
        self.viz = VisualizationManager("config/visualization_style.yaml")
    
    def generate_report_plots(self, data):
        """ç”ŸæˆæŠ¥å‘Šå›¾è¡¨"""
        self.viz.create_scatter_plot(...)
        self.viz.create_box_plot(...)
```

**åœ¨ tests/ æµ‹è¯•ä»£ç ä¸­**:
```python
# tests/test_visualization.py
import pytest
from utils.visualization_utils import VisualizationManager

class TestVisualization:
    def test_scatter_plot_generation(self, sample_data):
        """æµ‹è¯•æ•£ç‚¹å›¾ç”Ÿæˆ"""
        output_dirs = setup_visualization_environment()
        viz = VisualizationManager()
        
        viz.create_scatter_plot(
            sample_data['x'], sample_data['y'],
            output_path=str(output_dirs['figures'] / "test_scatter.png"),
            title="Test Scatter Plot"
        )
        
        assert (output_dirs['figures'] / "test_scatter.png").exists()
```

**åœ¨ experiments/ å®éªŒä»£ç ä¸­**:
```python
# experiments/protein_analysis/scripts/03_visualization.py
import sys
from pathlib import Path

# æ·»åŠ å·¥å…·è·¯å¾„
sys.path.append(str(Path(__file__).parent.parent.parent.parent / "utils"))
from visualization_utils import VisualizationManager

# å®éªŒç‰¹å®šé…ç½®
EXPERIMENT_ROOT = Path.cwd()
OUTPUT_DIRS = setup_visualization_environment()

viz = VisualizationManager()  # ä½¿ç”¨é»˜è®¤æˆ–æ‰¾åˆ°çš„é…ç½®
```

### 10.2. é…ç½®æ–‡ä»¶ç®¡ç†ç­–ç•¥
1. **é¡¹ç›®çº§é…ç½®**: `config/visualization_style.yaml` - æ•´ä¸ªé¡¹ç›®çš„ç»Ÿä¸€é…ç½®
2. **å®éªŒçº§é…ç½®**: `experiments/<n>/config/visualization.yaml` - å®éªŒç‰¹å®šè®¾ç½®  
3. **ä¼˜å…ˆçº§**: å®éªŒçº§ > é¡¹ç›®çº§ > é»˜è®¤é…ç½®

---

## 11. æ•…éšœæ’é™¤ä¸ä¼˜åŒ– (Troubleshooting & Optimization)

### 11.1. å¸¸è§é—®é¢˜è§£å†³
- **å­—ä½“é—®é¢˜**: ç¡®ä¿ä½¿ç”¨è·¨å¹³å°å…¼å®¹çš„å­—ä½“
- **é¢œè‰²æ˜¾ç¤º**: éªŒè¯é¢œè‰²åœ¨ä¸åŒæ˜¾ç¤ºå™¨ä¸Šçš„ä¸€è‡´æ€§  
- **æ–‡ä»¶æƒé™**: ç¡®ä¿è¾“å‡ºç›®å½•æœ‰å†™å…¥æƒé™
- **å†…å­˜ä½¿ç”¨**: å¤§æ•°æ®é›†å¯è§†åŒ–æ—¶çš„å†…å­˜ä¼˜åŒ–

### 11.2. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **æ‰¹é‡å¤„ç†**: å¤šå›¾è¡¨æ—¶ä½¿ç”¨æ‰¹é‡ç”Ÿæˆæ¨¡å¼
- **ç¼“å­˜é…ç½®**: é¿å…é‡å¤åŠ è½½é…ç½®æ–‡ä»¶
- **å¼‚æ­¥ä¿å­˜**: å¤§å›¾è¡¨ä½¿ç”¨å¼‚æ­¥ä¿å­˜æœºåˆ¶

---

## 12. ç‰ˆæœ¬æ§åˆ¶ä¸æ–‡æ¡£ (Version Control & Documentation)

### 12.1. ç‰ˆæœ¬æ§åˆ¶è¦æ±‚
- **é…ç½®æ–‡ä»¶**: `visualization_style.yaml` å¿…é¡»çº³å…¥ç‰ˆæœ¬æ§åˆ¶
- **å·¥å…·ç±»**: `visualization_utils.py` å¿…é¡»çº³å…¥ç‰ˆæœ¬æ§åˆ¶
- **è¾“å‡ºå›¾è¡¨**: ä¸€èˆ¬ä¸çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†é‡è¦ç»“æœå¯è€ƒè™‘ä¿ç•™

### 12.2. æ–‡æ¡£è¦æ±‚
- **README**: é¡¹ç›® README ä¸­è¯´æ˜å¯è§†åŒ–æ ‡å‡†
- **æ³¨é‡Š**: å¤æ‚å¯è§†åŒ–ä»£ç å¿…é¡»æœ‰è¯¦ç»†æ³¨é‡Š
- **ç¤ºä¾‹**: æä¾›æ ‡å‡†çš„ä½¿ç”¨ç¤ºä¾‹ä»£ç 

---

é€šè¿‡ä¸¥æ ¼éµå¾ªè¿™å¥—å¯è§†åŒ–ä½¿ç”¨è§„èŒƒï¼Œç¡®ä¿é¡¹ç›®ä¸­æ¯ä¸ªè„šæœ¬çš„å¯è§†åŒ–è¾“å‡ºéƒ½èƒ½æ­£ç¡®å½’æ¡£ã€é£æ ¼ç»Ÿä¸€ï¼Œå¹¶ä¸ºæ•°æ®åˆ†æå’Œç»“æœéªŒè¯æä¾›å¯é çš„æ”¯æŒã€‚