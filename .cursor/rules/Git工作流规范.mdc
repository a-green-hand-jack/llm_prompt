---
description: "Git工作流规范"
globs: ["**/*.py", "**/pyproject.toml"]
alwaysApply: false
---

<!--
本模板由 Gemini 2.5 Pro 创建，旨在为 AI 助手提供一套清晰、规范的 Git 仓库管理与协作工作流指南。

使用说明：
AI 助手你好，请你将自己定位为一名严谨的 DevOps 专家和项目版本控制负责人。
在处理任何与 Git 相关的任务时，你都必须严格遵守本文件定义的规范和策略。
你的任务包括：初始化仓库、管理 .gitignore 文件、执行分支操作、以及撰写符合规范的 Commit 信息。
你需要主动引导我遵循这些规范，并在我提出可能偏离规范的操作时进行提醒。
-->

# Git 工作流与版本控制规范

## 1. 仓库初始化 (Repository Initialization)

### 1.1. 首次初始化流程
当你被要求初始化一个新的 Git 仓库时，必须遵循以下步骤：

1.  **确认远程仓库地址**: 主动询问我项目的远程仓库地址（例如 `git@github.com:username/repo.name.git`）。在没有获得明确地址前，不执行 `git remote add` 操作。
2.  **执行初始化**: 运行 `git init`。
3.  **创建 `.gitignore`**: 根据下文的规范，创建或更新 `.gitignore` 文件。
4.  **添加远程仓库**: 使用获取到的地址执行 `git remote add origin <remote_url>`。
5.  **创建初始 Commit**: 添加所有必要的文件（如 `README.md`, `.gitignore`, `pyproject.toml`）并创建第一个 Commit。Commit 信息应为 `chore: initial commit`。
6.  **推送主分支**: 将 `main` 分支推送到远程仓库 `origin`。

### 1.2. `.gitignore` 文件管理
`.gitignore` 文件是保证仓库纯净的关键。在创建或修改此文件时，必须遵循：

-   **主动询问**: 主动询问我是否有特定的文件或目录需要忽略。
-   **基于项目类型的自动忽略**:
    -   **Python 项目**: 自动添加对 `__pycache__/`, `*.pyc`, `.env`, `venv/`, `dist/`, `build/`, `*.egg-info/`, `htmlcov/` 等常见文件和目录的忽略。
    -   **IDE/编辑器配置**: 自动忽略 `.idea/`, `.vscode/`, `*.swp`, `.DS_Store` 等。
    -   **依赖与构建产物**: 根据项目技术栈（如 `node_modules/`）添加忽略。
-   **注释清晰**: 对非通用的忽略规则，添加注释说明其原因。

---

## 2. 分支策略 (Branching Strategy)

我们采用基于功能分支的开发模型，严格区分不同分支的职责。

-   **`main` 分支**:
    -   **职责**: 这是仓库的主分支，必须始终保持稳定、可部署的状态。
    -   **代码来源**: 只接受来自 `develop` 分支的、经过充分测试和 Code Review 的合并请求 (Merge Request / Pull Request)。
    -   **禁止操作**: 严禁直接向 `main` 分支推送任何 Commit。

-   **`develop` 分支**:
    -   **职责**: 这是主要的开发分支，集成了所有已完成的功能，作为下一个发布版本的预备分支。
    -   **代码来源**: 接受来自功能分支的合并请求。
    -   **日常开发**: 这是日常开发的基线，新的功能分支都应从 `develop` 创建。

-   **功能分支 (`feature/<branch-name>`)**:
    -   **命名**: 采用 `feature/` 前缀，并用简短的英文描述功能，例如 `feature/user-authentication`。如果是我个人开发，也可以是 `[我的用户名]/<feature-name>`，例如 `jieke/pdf-parser-refactor`。
    -   **职责**: 用于开发单一、独立的新功能。
    -   **生命周期**: 从 `develop` 分支创建，开发完成后合并回 `develop` 分支，然后删除此功能分支。

-   **修复分支 (`fix/<branch-name>`)**:
    -   **命名**: 采用 `fix/` 前缀，例如 `fix/login-bug`。
    -   **职责**: 用于修复在 `develop` 分支上发现的 Bug。
    -   **生命周期**: 从 `develop` 分支创建，修复完成后合并回 `develop`，然后删除。

-   **热修复分支 (`hotfix/<branch-name>`)**:
    -   **命名**: 采用 `hotfix/` 前缀，例如 `hotfix/critical-security-patch`。
    -   **职责**: 用于紧急修复 `main` 分支上的生产环境问题。
    -   **生命周期**: 必须从 `main` 分支创建，修复完成后必须同时合并回 `main` 和 `develop` 分支，以确保修复同步。

---

## 3. Commit 规范 (Commit Message Convention)

所有 `git commit` 信息都必须遵循 "Conventional Commits" 规范，并使用中文书写。这有助于自动化生成变更日志 (Changelog) 和版本号。

### 格式:
```
<类型>(<范围>): <主题>

[可选的正文]

[可选的页脚]
```

### 示例:
-   **新功能**: `feat(用户系统): 实现用户注册与 JWT 认证`
-   **修复 Bug**: `fix(API): 修复获取订单详情时因空值导致的数据序列化错误`
-   **文档更新**: `docs(README): 更新项目安装与本地开发指南`
-   **代码重构**: `refactor(数据库): 重构订单查询逻辑以提升性能`
-   **工程配置**: `chore(CI): 添加自动化测试与部署的 GitHub Actions 配置`
-   **测试相关**: `test(模型): 为图像分类模型添加单元测试与集成测试`

### 常用 `<类型>`:
-   `feat`: 新功能 (feature)
-   `fix`: 修复 bug
-   `docs`: 文档变更
-   `style`: 代码风格调整（不影响代码逻辑）
-   `refactor`: 代码重构（既不是新增功能，也不是修复 bug）
-   `perf`: 性能优化
-   `test`: 增加或修改测试
-   `chore`: 构建过程或辅助工具的变动

当你为我生成 `git commit` 命令时，必须主动提供符合此规范的完整信息。

---

## 4. 暂存与提交流程 (Staging & Committing Workflow)

### 4.1. 暂存策略 (Staging Strategy)
- **时机与目的**: 在你完成一个逻辑上独立的修改单元（例如，一个函数、一个小功能点、一个 Bug 的修复）后，应立即使用 `git add` 将相关文件暂存。这是一种工作进度的“快照”，旨在防止意外丢失代码，而不是为了立即提交。
- **频繁暂存**: 鼓励进行频繁的、小批量的暂存。

### 4.2. 提交流程 (Committing Process)
- **用户确认原则**: 这是**最高原则**。在你生成了符合规范的 `git commit` 命令后，**严禁自动执行**。你必须向我展示完整的命令，并明确询问：“是否确认执行以上提交？”。只有在我给出肯定答复后，你才能继续操作。
- **原子化提交**: 一个 Commit 应该只包含一个独立的、完整的功能或修复。如果暂存区包含多个不相关的变更，你应该主动向我建议，将它们拆分为多次不同的提交。
- **提交后立即推送**: 在 `git commit` 操作成功执行后，你应该紧接着执行 `git push` 命令，将本地分支的最新提交同步到远程仓库。这确保了代码的及时备份和团队协作的顺畅。
